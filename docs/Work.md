# Техническое описание модуля Carrot Quest для Bitrix

## Оглавление
1. [Установка][install]
2. [Компоненты][components]
* [Опции]]options.php]
* [Файл установки/параметров][index.php]
* [Класс взаимодействия с API carrotquest][CarrotQuestApi.php]
* [Класс обработчиков событий Bitrix][CarrotQuestEventHandlers.php]

## [Установка]: Установка
В дальнейшем будет установка из Marketplace. То, что есть на текущий момент - [здесь](https://github.com/M1hacka/BitrixCarrotquestModule/blob/master/docs/install.md).

## [components]: Составные части
### [options.php]: Файл options.php  
Описывает то, что отображается в админке в настройках модуля (Администрирование -> Настройки -> Настройки модулей -> Carrot quest). На текущий момент это настройки ключей, включение/отключение трекинга событий и включение/отключение бонусной системы.
### [index.php]: Файл index.php  
Описывает действия при установке и деинсталляции модулей. Имя класса должно совпадать с именем модуля (за исключением того, что точка заменяется на подчеркивание)
### [CarrotQuestApi.php]: Файл /classes/general/CarrotQuestApi.php  
Содержит класс со всеми функциями взаимодействия с Carrot quest. Обязательно должен быть создан перед использованием функций.
* **Connect** - подключает через js-API к CarrotQuest + отсылает идентификационные данные, если они есть.
* **Track** - Отслеживанbt событий со стороны сервера. Лучше не использовать, заменяя альтернативным вызовом jsAPI в нужном месте.
* **HttpPost**, **HttpGet** - методы для отсылки сообщений POST и GET запросами.
* **GetSelectedCarrots** - получение с сервера количества выбранных пользователем при заказе морковок.
* **OrderConfirm** - метод, который при включенной бонусной системе отсылает данные о сделанном заказе со стороны сервера, при выключенной - оставляет на волю клиентской стороны (должен быть вызван отдельный обработчик из JS). Чтобы корректно сработал, в куках должны хранится:
- *CQBasketItems* - массив содержимого корзины
- *CQOrderId* - ID созданного заказа.
Оба кука создаются в файле result_modifier.php переопределенного шаблона заказа из модуля sale.order.ajax
### [CarrotQuestEventHandlers.php]:  Файл /classes/general/CarrotQuestEventHandlers.php  
Обработчики всех событий, которые перехватывает система. Все методы статические.